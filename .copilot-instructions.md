# ü§ñ Instructions for AI Agents & Developers

## üéØ Project Status

**Phase 1**: ‚úÖ **COMPLETE**  
**Phase 2**: ‚è≥ **TODO** (4 tasks available)  
**Phase 3**: üîÆ **Future**

---

## üõ†Ô∏è Phase 2: Implementation Tasks

### Task 2A: Request/Response Schemas

**Goal**: Extract request/response schemas for all 404 endpoints.

**Input**: `perplexity_spa_full_spec.json`

**Implementation**:

```python
# 1. Load spec
import json
with open('perplexity_spa_full_spec.json') as f:
    spec = json.load(f)

# 2. For each endpoint in spec['endpoints']['rest']:
#    - Find in spec['requests']['api_calls']
#    - Extract query params from HAR
#    - Extract request body (if POST)
#    - Extract response sample

# 3. Search source codes for TypeScript interfaces:
#    - Decompress gzipped sources
#    - Parse with regex: interface <Name>Request {}
#    - Match endpoint names

# 4. Generate schema output:
schema = {
    "endpoint": "rest/finance/earnings",
    "method": "GET",
    "query_params": {
        "market_identifier": {"type": "string", "required": True}
    },
    "response_sample": {...},
    "typescript_interface": "..."
}
```

**Output**: `endpoint_schemas.json`

**Success Criteria**:
- [ ] Schemas for 380+ endpoints (with HAR data)
- [ ] Query params extracted
- [ ] Response samples included
- [ ] TypeScript interfaces found (where available)

---

### Task 2B: Component ‚Üí Hook ‚Üí API Graph

**Goal**: Map React component dependencies to hooks and APIs.

**Input**: Source codes in `perplexity_spa_full_spec.json`

**Implementation**:

```python
# 1. Decompress all source codes
# 2. Parse with regex:
#    - Components: export (default )?(function|const) <Name>
#    - Hooks: use[A-Z]\w+
#    - API calls: fetch\(.*rest/

# 3. Build graph:
graph = {
    "FinanceEarningsView": {
        "hooks": ["useFinanceEarnings", "useQueryState"],
        "endpoints": ["rest/finance/earnings"]
    }
}

# 4. Optionally: Generate mermaid diagram
```

**Output**: `component_graph.json`, `component_graph.mermaid`

**Success Criteria**:
- [ ] 100+ components mapped
- [ ] 195+ hooks identified
- [ ] Hooks ‚Üí endpoints linked
- [ ] Mermaid diagram generated

---

### Task 2C: Feature Flags & Experiments

**Goal**: Discover A/B tests and feature flags.

**Input**: Source codes + HAR `rest/experiments/attributes`

**Implementation**:

```python
# 1. Parse HAR for experiments endpoint response
# 2. Search source codes for:
#    - experimentEnabled("flag_name")
#    - useExperiment("flag_name")
#    - feature flags in config

# 3. Extract flag metadata:
flags = {
    "finance_earnings_redesign": {
        "status": "active",
        "found_in": ["FinanceEarningsView-xyz.js"],
        "type": "experiment"
    }
}
```

**Output**: `feature_flags.json`

**Success Criteria**:
- [ ] 20+ flags discovered
- [ ] Flags ‚Üí components mapped
- [ ] Active vs inactive status

---

### Task 2D: Real-time APIs (SSE/WebSocket)

**Goal**: Full specification of streaming endpoints.

**Input**: `perplexity_spa_full_spec.json['endpoints']['sse']` + HAR

**Implementation**:

```python
# 1. For each SSE endpoint:
#    - Extract path, method
#    - Find connection params (query strings)
#    - Parse message format from HAR

# 2. Generate AsyncAPI-style spec:
sse_spec = {
    "endpoint": "rest/sse/thread/stream",
    "protocol": "SSE",
    "message_format": {
        "event": "message",
        "data": {"type": "object", ...}
    }
}
```

**Output**: `realtime_apis.json`, optionally `asyncapi.yaml`

**Success Criteria**:
- [ ] 14+ SSE endpoints documented
- [ ] Message schemas extracted
- [ ] AsyncAPI spec (optional)

---

## üìñ Code Templates

### Loading Spec

```python
import json
import gzip
import base64

def load_spec():
    with open('perplexity_spa_full_spec.json') as f:
        return json.load(f)

def decompress_source(base64_data: str) -> str:
    compressed = base64.b64decode(base64_data)
    return gzip.decompress(compressed).decode('utf-8')

spec = load_spec()
for filename, base64_data in spec['source_codes'].items():
    source = decompress_source(base64_data)
    # Process source
```

### Parsing Source Code

```python
import re

# Find React components
component_pattern = r'export\s+(default\s+)?(function|const)\s+(\w+)'
components = re.findall(component_pattern, source)

# Find hooks
hook_pattern = r'use[A-Z]\w+'
hooks = re.findall(hook_pattern, source)

# Find API calls
api_pattern = r'fetch\(['"]\s*(/rest/[^'"]+)'
apis = re.findall(api_pattern, source)
```

---

## üìä Output Formats

### Example: endpoint_schemas.json

```json
{
  "rest/finance/earnings": {
    "method": "GET",
    "query_params": {
      "market_identifier": {"type": "string", "required": true}
    },
    "response_sample": {
      "earnings": [...]
    },
    "typescript_interface": "interface EarningsResponse { ... }",
    "observed_calls": 5
  }
}
```

### Example: component_graph.json

```json
{
  "FinanceEarningsView": {
    "type": "component",
    "hooks": ["useFinanceEarnings", "useQueryState"],
    "endpoints": ["rest/finance/earnings"],
    "file": "FinanceEarningsView-abc123.js"
  }
}
```

---

## ‚úÖ Quality Checklist

Before submitting:

- [ ] Output JSON is valid (use `json.dumps()` to validate)
- [ ] All keys are documented in output README
- [ ] At least 80% endpoint coverage (for schemas)
- [ ] Code is reproducible (someone can re-run)
- [ ] Added example usage in documentation
- [ ] Updated ROADMAP.md with completion status

---

## üöÄ How to Contribute

1. **Pick a task** from Phase 2 (2A-2D)
2. **Create issue**: `feat(2A): Extract endpoint schemas`
3. **Implement** using templates above
4. **Generate output** artifact (JSON file)
5. **Document** in PR description
6. **Update** ROADMAP.md status

---

## üìù Next Phase (Phase 3)

After Phase 2 completes:

- **3A**: Full OpenAPI v3 spec generation
- **3B**: AsyncAPI v3 for real-time APIs
- **3C**: SDK generation (Python/TypeScript)
- **3D**: Interactive API explorer

---

## üîó Links

- **Main Spec**: `perplexity_spa_full_spec.json` (1.9 MB)
- **Toolkit**: `perplexity_spec_toolkit.md`
- **CLI**: `spec_analyzer.py`
- **Roadmap**: `ROADMAP.md`

---

**Last Updated**: 22 January 2026  
**Status**: Phase 2 Ready  
**Contact**: See repo maintainers